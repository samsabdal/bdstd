<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Step 2: Make a Wish & Cut!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- GLOBAL & BACKGROUND --- */
        body {
            background: linear-gradient(135deg, #ffcce6, #c4e0ff);
            cursor: none;
            overflow: hidden;
            font-family: 'Arial Rounded MT Bold', sans-serif;
        }

        /* --- RIPPLE CURSOR --- */
        .cursor-ripple {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, opacity 0.2s;
            z-index: 9999;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .cursor-ripple.expanding {
            width: 50px;
            height: 50px;
            opacity: 0;
        }

        /* --- KNIFE (Hidden initially) --- */
        #knife {
            position: fixed;
            font-size: 80px;
            pointer-events: none;
            z-index: 100;
            transform: translate(-20px, -60px) rotate(-45deg);
            transition: transform 0.1s;
            filter: drop-shadow(5px 5px 5px rgba(0, 0, 0, 0.3));
            display: none;
            /* Hidden until candles are blown */
        }

        /* --- CAKE CONTAINER --- */
        .cake-wrapper {
            position: relative;
            width: 400px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cake-img {
            width: 100%;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }

        /* --- REALISTIC CANDLES (Enhanced) --- */
        .candle-container {
            position: absolute;
            top: 16px;
            /* Adjust based on your cake image height */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 25px;
            z-index: 20;
        }

        .candle {
            position: relative;
            width: 16px;
            /* Slightly wider for better 3D look */
            height: 50px;
            /* 3D Cylinder Effect */
            background: linear-gradient(to right, #e0e0e0 0%, #ffffff 50%, #e0e0e0 100%);
            /* You can change colors for colored candles, e.g., pink: 
               background: linear-gradient(to right, #ff99cc 0%, #ffccdd 50%, #ff99cc 100%); 
            */
            border-radius: 3px;
            box-shadow: inset 0 -5px 5px rgba(0, 0, 0, 0.1), 2px 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            touch-action: none;
        }

        /* Wick */
        .candle::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 6px;
            background: #333;
            border-radius: 1px;
            pointer-events: none;
        }

        .flame {
            position: absolute;
            bottom: 100%;
            /* Position right on top of candle/wick */
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 26px;
            background: radial-gradient(ellipse at bottom, rgba(0, 0, 255, 0.3) 0%, #ffff00 40%, #ff6600 70%, transparent 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            box-shadow: 0 -5px 15px rgba(255, 200, 0, 0.5), 0 -2px 5px rgba(255, 100, 0, 0.3);
            transform-origin: center bottom;
            animation: flicker 0.1s infinite alternate ease-in-out;
            opacity: 0.9;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .candle {
                width: 20px;
                height: 60px;
            }

            .flame {
                width: 22px;
                height: 35px;
            }

            .smoke {
                width: 12px;
            }

            .candle-container {
                gap: 35px;
            }
        }

        @keyframes flicker {
            0% {
                transform: translateX(-50%) scale(1) rotate(-2deg);
                opacity: 0.9;
            }

            25% {
                transform: translateX(-50%) scale(1.05) rotate(2deg);
                opacity: 1;
            }

            50% {
                transform: translateX(-50%) scale(0.95) rotate(-1deg);
                opacity: 0.8;
            }

            75% {
                transform: translateX(-50%) scale(1.05) rotate(1deg);
                opacity: 1;
            }

            100% {
                transform: translateX(-50%) scale(1) rotate(0deg);
                opacity: 0.9;
            }
        }

        /* Smoke Effect */
        .smoke {
            position: absolute;
            bottom: 100%;
            left: 50%;
            width: 6px;
            height: 10px;
            background: rgba(180, 180, 180, 0.6);
            border-radius: 50%;
            filter: blur(3px);
            opacity: 0;
            pointer-events: none;
            transform: translateX(-50%);
        }

        .candle.blown .flame {
            display: none;
        }

        .candle.blown .smoke {
            animation: smokeRise 2s forwards ease-out;
        }

        @keyframes smokeRise {
            0% {
                opacity: 0.7;
                transform: translateX(-50%) translateY(0) scale(1);
            }

            30% {
                opacity: 0.5;
                transform: translateX(-60%) translateY(-20px) scale(2);
            }

            60% {
                opacity: 0.3;
                transform: translateX(-40%) translateY(-50px) scale(3);
            }

            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-90px) scale(4);
            }
        }

        /* Dynamic Smoke Particle */
        .smoke-particle {
            position: fixed;
            /* Fixed to allow free movement outside candle container */
            width: 10px;
            height: 8px;
            background: rgba(50, 50, 50, 0.8);
            border-radius: 50%;
            filter: blur(5px);
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center h-screen">

    <div id="cursor" class="cursor-ripple"></div>

    <div id="knife">üî™</div>

    <h1 id="instruction-text" class="text-4xl text-purple-700 font-bold mb-12 drop-shadow-sm text-center">
        Step 1: Make a wish & blow the candles! üéÇ
    </h1>

    <div class="cake-wrapper" id="cake-area">

        <div class="candle-container" id="candles">
            <div class="candle">
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="candle">
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="candle">
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="candle">
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="candle">
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
        </div>

        <img id="cake-whole" src="images/cake1.png" class="cake-img" alt="Whole Cake">

        <img id="cake-cut" src="images/cake2.png" class="cake-img hidden" alt="Cut Cake">
    </div>

    <a id="next-btn" href="memories.html"
        class="hidden mt-12 bg-purple-600 hover:bg-purple-800 text-white font-bold py-3 px-8 rounded-full shadow-xl transition transform hover:scale-110 z-50 cursor-pointer">
        Open Gifts & Memories üéÅ
    </a>

    <script src="script.js"></script>

    <script>
        /* --- 1. RIPPLE CURSOR LOGIC --- */
        const cursor = document.getElementById('cursor');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';

            // Move knife if visible
            const knife = document.getElementById('knife');
            if (knife.style.display === 'block') {
                knife.style.left = e.clientX + 'px';
                knife.style.top = e.clientY + 'px';

                // Check for cutting logic
                if (isDragging) checkCut(e.clientX, e.clientY);
            }
        });

        document.addEventListener('mousedown', () => cursor.classList.add('expanding'));
        document.addEventListener('mouseup', () => cursor.classList.remove('expanding'));


        /* --- 2. CANDLE BLOWING LOGIC --- */
        const candles = document.querySelectorAll('.candle');
        let blownCount = 0;

        candles.forEach(candle => {
            candle.addEventListener('click', () => blowCandle(candle));
            candle.addEventListener('mouseover', () => blowCandle(candle)); // Blow on hover too
        });

        function blowCandle(candle) {
            if (!candle.classList.contains('blown')) {
                candle.classList.add('blown');
                blownCount++;

                // Dynamic Smoke Effect
                const rect = candle.getBoundingClientRect();
                createSmoke(rect.left + rect.width / 2, rect.top);

                // If all candles blown
                if (blownCount === candles.length) {
                    setTimeout(enableKnifeMode, 1000);
                }
            }
        }

        function createSmoke(x, y) {
            const particleCount = 12; /* Increased count */
            for (let i = 0; i < particleCount; i++) {
                const smoke = document.createElement('div');
                smoke.classList.add('smoke-particle');
                document.body.appendChild(smoke);

                // Randomize physics
                const angle = Math.random() * Math.PI * 2;
                const velocity = 0.5 + Math.random() * 1.5;
                const spreadX = (Math.random() - 0.5) * 30; /* Wider spread */
                const spreadY = -20 - Math.random() * 50; /* Rise higher */

                // Set initial position
                smoke.style.left = x + 'px';
                smoke.style.top = y + 'px';

                // Animate
                const duration = 2000 + Math.random() * 1500;

                smoke.animate([
                    { transform: `translate(0, 0) scale(1)`, opacity: 0.8 }, /* Higher start opacity */
                    { transform: `translate(${spreadX}px, ${spreadY - 80}px) scale(4)`, opacity: 0 }
                ], {
                    duration: duration,
                    easing: 'ease-out',
                    fill: 'forwards'
                });

                // Cleanup
                setTimeout(() => smoke.remove(), duration);
            }
        }

        /* --- 3. KNIFE & CUTTING LOGIC --- */
        const knife = document.getElementById('knife');
        const instructionText = document.getElementById('instruction-text');
        const cakeWhole = document.getElementById('cake-whole');
        const cakeCut = document.getElementById('cake-cut');
        let isDragging = false;
        let isCut = false;

        function enableKnifeMode() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            instructionText.innerText = isMobile ? "Step 2: Drag your finger to cut the cake! üî™" : "Step 2: Drag the knife to cut the cake! üî™";
            knife.style.display = 'block';
            document.body.style.cursor = 'none'; // Ensure default cursor is gone
        }

        document.addEventListener('mousedown', () => {
            if (knife.style.display === 'block') {
                isDragging = true;
                knife.style.transform = "translate(-20px, -50px) rotate(0deg) scale(1.2)"; // Stab animation
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            knife.style.transform = "translate(-20px, -60px) rotate(-45deg)"; // Reset
        });

        // Touch events for mobile
        document.addEventListener('touchstart', () => {
            if (knife.style.display === 'block') {
                isDragging = true;
                knife.style.transform = "translate(-20px, -50px) rotate(0deg) scale(1.2)";
            }
        });

        document.addEventListener('touchmove', (e) => {
            if (knife.style.display === 'block' && e.touches.length > 0) {
                const touch = e.touches[0];
                knife.style.left = touch.clientX + 'px';
                knife.style.top = touch.clientY + 'px';

                if (isDragging) checkCut(touch.clientX, touch.clientY);
            }
        });

        document.addEventListener('touchend', () => {
            isDragging = false;
            knife.style.transform = "translate(-20px, -60px) rotate(-45deg)";
        });

        function checkCut(x, y) {
            if (isCut) return;

            const rect = cakeWhole.getBoundingClientRect();

            // Check if knife crosses the center of the cake
            if (x > rect.left + 50 && x < rect.right - 50 &&
                y > rect.top + 50 && y < rect.bottom - 50) {

                triggerCut();
            }
        }

        function triggerCut() {
            isCut = true;
            cakeWhole.classList.add('hidden');
            cakeCut.classList.remove('hidden');

            // Hide Candles (optional, looks cleaner if they disappear or you can keep them)
            document.getElementById('candles').style.opacity = '0';

            // Celebration Text
            const cakeName = (window.firstName || 'Friend');
            instructionText.innerText = `Happy Birthday! ${cakeName} üéâ`;
            instructionText.classList.add('text-pink-600');

            // Show Next Button
            document.getElementById('next-btn').classList.remove('hidden');

            // Confetti Effect (Simple JS CSS)
            createConfetti();
        }

        function createConfetti() {
            const emojis = ['üéâ', 'üéä', '‚ú®', 'üéà', 'üéÅ', '‚≠ê', 'üí´', 'üåü'];
            const colors = ['#ff1744', '#f50057', '#d500f9', '#651fff', '#2979f3', '#00b0ff', '#00e5ff', '#1de9b6', '#00e676', '#76ff03'];

            // Left Bottom Corner Confetti
            for (let i = 0; i < 25; i++) {
                createConfettiPiece('left', colors, emojis);
            }

            // Right Bottom Corner Confetti
            for (let i = 0; i < 25; i++) {
                createConfettiPiece('right', colors, emojis);
            }

            // Center area bonus confetti
            for (let i = 0; i < 15; i++) {
                createConfettiPiece('center', colors, emojis);
            }
        }

        function createConfettiPiece(corner, colors, emojis) {
            const conf = document.createElement('div');
            conf.style.position = 'fixed';
            conf.style.fontSize = (Math.random() * 20 + 20) + 'px';
            conf.style.pointerEvents = 'none';
            conf.style.userSelect = 'none';
            conf.textContent = emojis[Math.floor(Math.random() * emojis.length)];

            let startX, endX;

            if (corner === 'left') {
                startX = Math.random() * 150;
                endX = startX - Math.random() * 300;
                conf.style.left = startX + 'px';
            } else if (corner === 'right') {
                startX = window.innerWidth - Math.random() * 150;
                endX = startX + Math.random() * 300;
                conf.style.left = startX + 'px';
            } else {
                startX = window.innerWidth / 2 + (Math.random() - 0.5) * 400;
                endX = startX + (Math.random() - 0.5) * 200;
                conf.style.left = startX + 'px';
            }

            conf.style.top = window.innerHeight + 'px';
            conf.style.zIndex = Math.floor(Math.random() * 1000);
            conf.style.opacity = '1';
            conf.style.transform = 'rotate(0deg) scale(1)';
            conf.style.transition = `all ${Math.random() * 2 + 2.5}s ease-in`;

            document.body.appendChild(conf);

            // Trigger animation
            setTimeout(() => {
                conf.style.top = (Math.random() * -200 - 100) + 'px';
                conf.style.left = endX + 'px';
                conf.style.opacity = '0';
                conf.style.transform = `rotate(${Math.random() * 720}deg) scale(0)`;
            }, 50);

            // Remove after animation
            setTimeout(() => {
                conf.remove();
            }, Math.random() * 2000 + 4000);
        }
    </script>
</body>

</html>